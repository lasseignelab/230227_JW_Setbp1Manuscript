---
title: "Setbp1_PANDA_ppi"
author: "Jordan Whitlock"
date: '2022-09-06'
output: html_document
---

* Generating PPI Input for Mus Musculus (Mouse):
  * STRING:
    * The NetZoo package has a nice wrapper function here: https://netzoo.github.io/netZooR/reference/source.PPI.html, however, one cannot change the filtering threshold using this package. Instead I used the stringDB package to pull in the latest version
    * All that is needed is for the user to specify the input query TFs that an individual would like to search for in the string database. 
    * Then the species.index must be specified, here I use the mouse NCBI taxon-id (10090; https://string-db.org/cgi/organisms).
  *Input TFs were obtained from the TF Motif input constructed in Setbp1_PANDA_TFmotif.Rmd called 'mus_motif_all.txt'

## Code: 

Accompanying dry lab notebook for this analysis is here: https://docs.google.com/document/d/1FO_Je9oxbBFF9S_k-8tVF2t4ba88O4C77sw1v7DIFec/edit?usp=sharing

## loading in libraries
```{r}
library(STRINGdb)
library(stringr)
library(here)
library(styler)
library(lintr)
set.seed(2178)
```

## loading in the TF-motif input data (needed as input to construct PPI):
```{r}
mus_motif_all <- read.table(here("data/processed/motif_inputs/mus_motif_all.txt"), sep = "\t")
```


## score threshold at 700
Threshold scores go from 0 - 1000 and represent the confidence in the interactions present based on literature and experimental data. The lower, the less stringent. 
```{r}
# create a new STRINGdb class with specified version, species and score threshold
string_db <- STRINGdb$new(version = "11.5", species = as.numeric(10090), score_threshold = 700) # version was 11.5 as of 221027, 10090 species index is for mus musculus
# create a TF data frame with one column
TF <- data.frame(mus_motif_all[, 1]) # grabs the TF column from this data
# change the colname to "TF"
colnames(TF) <- "TF"
TF <- unique(TF)
# map the TF to STRINGdb dataset
TF_mapped <- string_db$map(TF, "TF", removeUnmappedRows = TRUE) # Warning:  we couldn't map to STRING 1% of your identifiers. Setting removeUnmappedRows to TRUE or FALSE doesn't make a difference.
# collect the interactions between the TF of interest
ppi_tmp <- string_db$get_interactions(TF_mapped$STRING_id)[, c(1, 2, 3)] # contains duplicate data
ppi_tmp <- unique(ppi_tmp) # removing duplicates
# store the PPI by using original identifier.
mm10_ppi <- data.frame(from = TF_mapped[match(ppi_tmp$from, TF_mapped$STRING_id), 1], to = TF_mapped[match(ppi_tmp$to, TF_mapped$STRING_id), 1], score = ppi_tmp$combined_score)
nrow(mm10_ppi) # 2346

head(mm10_ppi) # creates a dataframe with a "from" and a "to" column for PPI

# All protein names returned are in all capital, even though they are mouse (as specified by 10090 above). R is case sensitive, so need to convert these to be lowercase with first letter capital
from <- str_to_title(mm10_ppi$from)
to <- str_to_title(mm10_ppi$to)
score <- str_to_title(mm10_ppi$score)

mm10_ppi_700 <- data.frame(from, to, score)
```

## saving the final PPI input 
```{r}
write.table(mm10_ppi_700, file = here("data/processed/ppi_inputs/mm10_ppi_700.txt"), sep = "\t") # save final input data to Cheaha for use in network construction
```

CIRCLING BACK TO LOOK AT ADDITIONAL PPI INPUT THRESHOLDS BECAUSE SETBP1 IS ONLY CAPTURED AS A GENE AND NOT A TF IN PANDA NETWORKS 

## score threshold at 500
Threshold scores go from 0 - 1000 and represent the confidence in the interactions present based on literature and experimental data. The lower, the less stringent. 
```{r}
# create a new STRINGdb class with specified version, species and score threshold
string_db <- STRINGdb$new(version = "11.5", species = as.numeric(10090), score_threshold = 500) # version was 11.5 as of 221027, 10090 species index is for mus musculus
# create a TF data frame with one column
TF <- data.frame(mus_motif_all[, 1]) # grabs the TF column from this data
# change the colname to "TF"
colnames(TF) <- "TF"
TF <- unique(TF)
# map the TF to STRINGdb dataset
TF_mapped <- string_db$map(TF, "TF", removeUnmappedRows = TRUE) # Warning:  we couldn't map to STRING 1% of your identifiers. Setting removeUnmappedRows to TRUE or FALSE doesn't make a difference.
# collect the interactions between the TF of interest
ppi_tmp <- string_db$get_interactions(TF_mapped$STRING_id)[, c(1, 2, 3)] # contains duplicate data
ppi_tmp <- unique(ppi_tmp) # removing duplicates
# store the PPI by using original identifier.
mm10_ppi <- data.frame(from = TF_mapped[match(ppi_tmp$from, TF_mapped$STRING_id), 1], to = TF_mapped[match(ppi_tmp$to, TF_mapped$STRING_id), 1], score = ppi_tmp$combined_score)
nrow(mm10_ppi) # 2346

head(mm10_ppi) # creates a dataframe with a "from" and a "to" column for PPI

# All protein names returned are in all capital, even though they are mouse (as specified by 10090 above). R is case sensitive, so need to convert these to be lowercase with first letter capital
from <- str_to_title(mm10_ppi$from)
to <- str_to_title(mm10_ppi$to)
score <- str_to_title(mm10_ppi$score)

mm10_ppi_500 <- data.frame(from, to, score)


write.table(mm10_ppi_500, file = here("data/processed/ppi_inputs/mm10_ppi_500.txt"), sep = "\t") # save final input data to Cheaha for use in network construction
```

## score threshold at 400
Threshold scores go from 0 - 1000 and represent the confidence in the interactions present based on literature and experimental data. The lower, the less stringent. 
```{r}
# create a new STRINGdb class with specified version, species and score threshold
string_db <- STRINGdb$new(version = "11.5", species = as.numeric(10090), score_threshold = 400) # version was 11.5 as of 221027, 10090 species index is for mus musculus
# create a TF data frame with one column
TF <- data.frame(mus_motif_all[, 1]) # grabs the TF column from this data
# change the colname to "TF"
colnames(TF) <- "TF"
TF <- unique(TF)
# map the TF to STRINGdb dataset
TF_mapped <- string_db$map(TF, "TF", removeUnmappedRows = TRUE) # Warning:  we couldn't map to STRING 1% of your identifiers. Setting removeUnmappedRows to TRUE or FALSE doesn't make a difference.
# collect the interactions between the TF of interest
ppi_tmp <- string_db$get_interactions(TF_mapped$STRING_id)[, c(1, 2, 3)] # contains duplicate data
ppi_tmp <- unique(ppi_tmp) # removing duplicates
# store the PPI by using original identifier.
mm10_ppi <- data.frame(from = TF_mapped[match(ppi_tmp$from, TF_mapped$STRING_id), 1], to = TF_mapped[match(ppi_tmp$to, TF_mapped$STRING_id), 1], score = ppi_tmp$combined_score)
nrow(mm10_ppi) # 2346

head(mm10_ppi) # creates a dataframe with a "from" and a "to" column for PPI

# All protein names returned are in all capital, even though they are mouse (as specified by 10090 above). R is case sensitive, so need to convert these to be lowercase with first letter capital
from <- str_to_title(mm10_ppi$from)
to <- str_to_title(mm10_ppi$to)
score <- str_to_title(mm10_ppi$score)

mm10_ppi_400 <- data.frame(from, to, score)

write.table(mm10_ppi_400, file = here("data/processed/ppi_inputs/mm10_ppi_400.txt"), sep = "\t") # save final input data to Cheaha for use in network construction
```

## score threshold at 300
Threshold scores go from 0 - 1000 and represent the confidence in the interactions present based on literature and experimental data. The lower, the less stringent. 
```{r}
# create a new STRINGdb class with specified version, species and score threshold
string_db <- STRINGdb$new(version = "11.5", species = as.numeric(10090), score_threshold = 300) # version was 11.5 as of 221027, 10090 species index is for mus musculus
# create a TF data frame with one column
TF <- data.frame(mus_motif_all[, 1]) # grabs the TF column from this data
# change the colname to "TF"
colnames(TF) <- "TF"
TF <- unique(TF)
# map the TF to STRINGdb dataset
TF_mapped <- string_db$map(TF, "TF", removeUnmappedRows = TRUE) # Warning:  we couldn't map to STRING 1% of your identifiers. Setting removeUnmappedRows to TRUE or FALSE doesn't make a difference.
# collect the interactions between the TF of interest
ppi_tmp <- string_db$get_interactions(TF_mapped$STRING_id)[, c(1, 2, 3)] # contains duplicate data
ppi_tmp <- unique(ppi_tmp) # removing duplicates
# store the PPI by using original identifier.
mm10_ppi <- data.frame(from = TF_mapped[match(ppi_tmp$from, TF_mapped$STRING_id), 1], to = TF_mapped[match(ppi_tmp$to, TF_mapped$STRING_id), 1], score = ppi_tmp$combined_score)
nrow(mm10_ppi) # 2346

head(mm10_ppi) # creates a dataframe with a "from" and a "to" column for PPI

# All protein names returned are in all capital, even though they are mouse (as specified by 10090 above). R is case sensitive, so need to convert these to be lowercase with first letter capital
from <- str_to_title(mm10_ppi$from)
to <- str_to_title(mm10_ppi$to)
score <- str_to_title(mm10_ppi$score)

mm10_ppi_300 <- data.frame(from, to, score)

write.table(mm10_ppi_300, file = here("data/processed/ppi_inputs/mm10_ppi_300.txt"), sep = "\t") # save final input data to Cheaha for use in network construction
```

## score threshold at 200
Threshold scores go from 0 - 1000 and represent the confidence in the interactions present based on literature and experimental data. The lower, the less stringent. 
```{r}
# create a new STRINGdb class with specified version, species and score threshold
string_db <- STRINGdb$new(version = "11.5", species = as.numeric(10090), score_threshold = 200) # version was 11.5 as of 221027, 10090 species index is for mus musculus
# create a TF data frame with one column
TF <- data.frame(mus_motif_all[, 1]) # grabs the TF column from this data
# change the colname to "TF"
colnames(TF) <- "TF"
TF <- unique(TF)
# map the TF to STRINGdb dataset
TF_mapped <- string_db$map(TF, "TF", removeUnmappedRows = TRUE) # Warning:  we couldn't map to STRING 1% of your identifiers. Setting removeUnmappedRows to TRUE or FALSE doesn't make a difference.
# collect the interactions between the TF of interest
ppi_tmp <- string_db$get_interactions(TF_mapped$STRING_id)[, c(1, 2, 3)] # contains duplicate data
ppi_tmp <- unique(ppi_tmp) # removing duplicates
# store the PPI by using original identifier.
mm10_ppi <- data.frame(from = TF_mapped[match(ppi_tmp$from, TF_mapped$STRING_id), 1], to = TF_mapped[match(ppi_tmp$to, TF_mapped$STRING_id), 1], score = ppi_tmp$combined_score)
nrow(mm10_ppi) # 2346

head(mm10_ppi) # creates a dataframe with a "from" and a "to" column for PPI

# All protein names returned are in all capital, even though they are mouse (as specified by 10090 above). R is case sensitive, so need to convert these to be lowercase with first letter capital
from <- str_to_title(mm10_ppi$from)
to <- str_to_title(mm10_ppi$to)
score <- str_to_title(mm10_ppi$score)

mm10_ppi_200 <- data.frame(from, to, score)

write.table(mm10_ppi_200, file = here("data/processed/ppi_inputs/mm10_ppi_200.txt"), sep = "\t") # save final input data to Cheaha for use in network construction
```

## score threshold at 100
Threshold scores go from 0 - 1000 and represent the confidence in the interactions present based on literature and experimental data. The lower, the less stringent. 
```{r}
# create a new STRINGdb class with specified version, species and score threshold
string_db <- STRINGdb$new(version = "11.5", species = as.numeric(10090), score_threshold = 100) # version was 11.5 as of 221027, 10090 species index is for mus musculus
# create a TF data frame with one column
TF <- data.frame(mus_motif_all[, 1]) # grabs the TF column from this data
# change the colname to "TF"
colnames(TF) <- "TF"
TF <- unique(TF)
# map the TF to STRINGdb dataset
TF_mapped <- string_db$map(TF, "TF", removeUnmappedRows = TRUE) # Warning:  we couldn't map to STRING 1% of your identifiers. Setting removeUnmappedRows to TRUE or FALSE doesn't make a difference.
# collect the interactions between the TF of interest
ppi_tmp <- string_db$get_interactions(TF_mapped$STRING_id)[, c(1, 2, 3)] # contains duplicate data
ppi_tmp <- unique(ppi_tmp) # removing duplicates
# store the PPI by using original identifier.
mm10_ppi <- data.frame(from = TF_mapped[match(ppi_tmp$from, TF_mapped$STRING_id), 1], to = TF_mapped[match(ppi_tmp$to, TF_mapped$STRING_id), 1], score = ppi_tmp$combined_score)
nrow(mm10_ppi) # 2346

head(mm10_ppi) # creates a dataframe with a "from" and a "to" column for PPI

# All protein names returned are in all capital, even though they are mouse (as specified by 10090 above). R is case sensitive, so need to convert these to be lowercase with first letter capital
from <- str_to_title(mm10_ppi$from)
to <- str_to_title(mm10_ppi$to)
score <- str_to_title(mm10_ppi$score)

mm10_ppi_100 <- data.frame(from, to, score)

write.table(mm10_ppi_100, file = here("data/processed/ppi_inputs/mm10_ppi_100.txt"), sep = "\t") # save final input data to Cheaha for use in network construction
```

## score threshold at 0
Threshold scores go from 0 - 1000 and represent the confidence in the interactions present based on literature and experimental data. The lower, the less stringent. 
```{r}
# create a new STRINGdb class with specified version, species and score threshold
string_db <- STRINGdb$new(version = "11.5", species = as.numeric(10090), score_threshold = 0) # version was 11.5 as of 221027, 10090 species index is for mus musculus
# create a TF data frame with one column
TF <- data.frame(mus_motif_all[, 1]) # grabs the TF column from this data
# change the colname to "TF"
colnames(TF) <- "TF"
TF <- unique(TF)
# map the TF to STRINGdb dataset
TF_mapped <- string_db$map(TF, "TF", removeUnmappedRows = TRUE) # Warning:  we couldn't map to STRING 1% of your identifiers. Setting removeUnmappedRows to TRUE or FALSE doesn't make a difference.
# collect the interactions between the TF of interest
ppi_tmp <- string_db$get_interactions(TF_mapped$STRING_id)[, c(1, 2, 3)] # contains duplicate data
ppi_tmp <- unique(ppi_tmp) # removing duplicates
# store the PPI by using original identifier.
mm10_ppi <- data.frame(from = TF_mapped[match(ppi_tmp$from, TF_mapped$STRING_id), 1], to = TF_mapped[match(ppi_tmp$to, TF_mapped$STRING_id), 1], score = ppi_tmp$combined_score)
nrow(mm10_ppi) # 2346

head(mm10_ppi) # creates a dataframe with a "from" and a "to" column for PPI

# All protein names returned are in all capital, even though they are mouse (as specified by 10090 above). R is case sensitive, so need to convert these to be lowercase with first letter capital
from <- str_to_title(mm10_ppi$from)
to <- str_to_title(mm10_ppi$to)
score <- str_to_title(mm10_ppi$score)

mm10_ppi <- data.frame(from, to, score)

write.table(mm10_ppi, file = here("data/processed/ppi_inputs/mm10_ppi.txt"), sep = "\t") # save final input data to Cheaha for use in network construction
```

Conclusion: After looking at networks generated from multiple different score thresholds for the STRINGdb PPI data (see 'Checking_Setbp1_Inputs.Rmd' in "/data/user/jbarham3/jw_cellspecific/jw_cellspecific/setbp1_clean/network_scripts/"), I will be using an un-thresholded PPI input (mm10_ppi) for the network (score = 0), to maximize the number of interactions with Setbp1 and other proteins captured. 

```{r}
# run style
style_file(here("src/seurat_scripts/Setbp1_PANDA_ppi.Rmd"))
# lintr was run as well
```

```{r}
proc.time()
```
   user  system elapsed 
308.879  14.007 428.678 

```{r}
sessionInfo()
```
R version 4.1.3 (2022-03-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.5 LTS

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] lintr_3.0.2    styler_1.9.0   here_1.0.1     stringr_1.5.0  STRINGdb_2.6.5

loaded via a namespace (and not attached):
 [1] gtools_3.9.4       xfun_0.37          remotes_2.4.2      purrr_1.0.1        vctrs_0.5.2        htmltools_0.5.4    yaml_2.3.7         hash_2.2.6.2      
 [9] chron_2.3-59       blob_1.2.3         rlang_1.0.6        R.oo_1.25.0        withr_2.5.0        glue_1.6.2         DBI_1.1.3          R.utils_2.12.2    
[17] bit64_4.0.5        RColorBrewer_1.1-3 gsubfn_0.7         lifecycle_1.0.3    R.cache_0.16.0     plyr_1.8.8         R.methodsS3_1.8.2  caTools_1.18.2    
[25] evaluate_0.20      memoise_2.0.1      knitr_1.42         callr_3.7.3        fastmap_1.1.1      ps_1.7.2           rex_1.2.1          proto_1.0.0       
[33] Rcpp_1.0.10        KernSmooth_2.23-20 cachem_1.0.7       plotrix_3.8-2      desc_1.4.2         bit_4.0.5          gplots_3.1.3       png_0.1-8         
[41] digest_0.6.31      stringi_1.7.12     processx_3.8.0     rprojroot_2.0.3    cli_3.6.0          tools_4.1.3        bitops_1.0-7       magrittr_2.0.3    
[49] sqldf_0.4-11       lazyeval_0.2.2     RCurl_1.98-1.10    RSQLite_2.3.0      crayon_1.5.2       pkgconfig_2.0.3    xml2_1.3.3         cyclocomp_1.1.0   
[57] rmarkdown_2.20     rstudioapi_0.14    R6_2.5.1           igraph_1.4.1       compiler_4.1.3    
