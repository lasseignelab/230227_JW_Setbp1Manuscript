---
title: "Human_PANDA_ppi"
output: html_document
date: '2022-11-15'
---
# Generating own stringDB ppi input without NetZoo wrapper function:
generate my own ppi input using the stringDB package without the network zoo wrapper function to figure out why the threshold is not working. 

* Generating PPI Input for Human:
  * STRING:
    * The NetZoo package has a nice wrapper function here: https://netzoo.github.io/netZooR/reference/source.PPI.html, however, one cannot change the filtering threshold using this package. Instead I used the stringDB package to pull in the latest version
    * All that is needed is for the user to specify the input query TFs that an individual would like to search for in the string database. 
    * Then the species.index must be specified, here I use the mouse NCBI taxon-id (9606; https://string-db.org/cgi/organisms).
  *Input TFs were obtained from the TF Motif input constructed in Setbp1_PANDA_TFmotif.Rmd called 'mm10_TFmotifs.txt'

## Code: 

Accompanying dry lab notebook for this analysis is here: https://docs.google.com/document/d/1FO_Je9oxbBFF9S_k-8tVF2t4ba88O4C77sw1v7DIFec/edit?usp=sharing

## loading in libraries
```{r}
library(STRINGdb)
library(stringr)
library(styler)
library(here)
set.seed(2178)
```

## loading in the TF-motif input data (needed as input to construct PPI):
```{r}
hg38_TFmotifs <- read.table(here("data/processed/motif_inputs/hg38_TFmotifs.txt"),
  sep = "\t"
)
```


## generate PPI input without threshold 
Threshold scores go from 0 - 1000 and represent the confidence in the interactions present based on literature and experimental data. The lower, the less stringent. 
```{r}
# create a new STRINGdb class with specified version, species and score threshold
string_db <- STRINGdb$new(
  version = "11.5",
  species = as.numeric(9606),
  score_threshold = 0
) # version was 11.5 as of 221115, 9606 species index is for homo sapiens
# create a TF data frame with one column
TF <- data.frame(hg38_TFmotifs[, 1]) # grabs the TF column from this data
# change the colname to "TF"
colnames(TF) <- "TF"
TF <- unique(TF)
# map the TF to STRINGdb dataset
TF_mapped <- string_db$map(TF,
  "TF",
  removeUnmappedRows = TRUE
) # Warning:  we couldn't map to STRING 0% of your identifiers. Setting removeUnmappedRows to TRUE or FALSE doesn't make a difference.
# collect the interactions between the TF of interest
ppi_tmp <- string_db$get_interactions(TF_mapped$STRING_id)[, c(1, 2, 3)] # contains duplicate data
ppi_tmp <- unique(ppi_tmp) # removing duplicates
# store the PPI by using original identifier.
hg38_ppi <- data.frame(
  from = TF_mapped[match(ppi_tmp$from, TF_mapped$STRING_id), 1],
  to = TF_mapped[match(ppi_tmp$to, TF_mapped$STRING_id), 1],
  score = ppi_tmp$combined_score
)
nrow(hg38_ppi) # 70,974

head(hg38_ppi) # creates a dataframe with a "from" and a "to" column for PPI
```

## saving the final PPI input 
```{r}
write.table(hg38_ppi, file = here("data/processed/ppi_inputs/hg38_ppi.txt"), sep = "\t") # save final input data to Cheaha for use in network construction
```

```{r}
sessionInfo()
```
R version 4.1.3 (2022-03-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.5 LTS

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] here_1.0.1     styler_1.9.0   stringr_1.5.0  STRINGdb_2.6.5

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.10        compiler_4.1.3     RColorBrewer_1.1-3 plyr_1.8.8         R.utils_2.12.2     R.methodsS3_1.8.2  bitops_1.0-7       tools_4.1.3       
 [9] digest_0.6.31      bit_4.0.5          R.cache_0.16.0     lifecycle_1.0.3    RSQLite_2.3.0      memoise_2.0.1      pkgconfig_2.0.3    png_0.1-8         
[17] rlang_1.0.6        igraph_1.4.1       DBI_1.1.3          cli_3.6.0          rstudioapi_0.14    xfun_0.37          proto_1.0.0        fastmap_1.1.1     
[25] knitr_1.42         vctrs_0.5.2        gtools_3.9.4       caTools_1.18.2     rprojroot_2.0.3    bit64_4.0.5        glue_1.6.2         sqldf_0.4-11      
[33] plotrix_3.8-2      hash_2.2.6.2       gsubfn_0.7         purrr_1.0.1        blob_1.2.3         magrittr_2.0.3     gplots_3.1.3       KernSmooth_2.23-20
[41] stringi_1.7.12     RCurl_1.98-1.10    cachem_1.0.7       chron_2.3-59       R.oo_1.25.0       

```{r}
proc.time()
```
   user  system elapsed 
 88.319   8.218 208.093
 
```{r}
# run style
style_file(here("src/network_scripts/input_construction/Human_PANDA_ppi.Rmd"))
# lintr was run as well
```

